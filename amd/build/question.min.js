/**
 * JavaScript to allow dragging options to slots (using mouse down or touch) or tab through slots using keyboard.
 *
 * @module     qtype_drawlines/question
 * @copyright  2024 The Open University
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_drawlines/question",["jquery","core/dragdrop","qtype_drawlines/Line","core/key_codes","core_form/changechecker"],(function($,dragDrop,Lines,keys,FormChangeChecker){function DrawlinesQuestion(containerId,readOnly,visibleDropZones,questionLines){var thisQ=this;this.containerId=containerId,this.visibleDropZones=visibleDropZones,this.questionLines=questionLines,this.lineSVGs=[],this.lines=[],this.isPrinting=!1,this.questionAnswer={},this.svgEl=null,readOnly&&this.getRoot().addClass("qtype_drawlines-readonly"),thisQ.allImagesLoaded=!1,thisQ.getNotYetLoadedImages().one("load",(function(){thisQ.waitForAllImagesToBeLoaded()})),thisQ.waitForAllImagesToBeLoaded()}DrawlinesQuestion.prototype.updateCoordinates=function(){for(var line=0;line<this.lineSVGs.length;line++){var coordinates=this.getCoordinates(this.lineSVGs[line]);if(!this.lines[line].parse(coordinates[0],coordinates[1],1))return;this.updateSvgEl(line)}},DrawlinesQuestion.prototype.parseCoordinates=function(coordinates,lineType){var bits=coordinates.split(" ");if("lineinfinite"===lineType&&(bits=bits.slice(1,-1)),2!==bits.length)throw new Error(coordinates+" is not a valid point");return bits},DrawlinesQuestion.prototype.drawSVGLines=function(questionLines){var height,startcoordinates,endcoordinates,draginitialcoords,bgImage=document.querySelector("img.dropbackground");document.querySelector(".draghomes").innerHTML='<svg xmlns="http://www.w3.org/2000/svg" class="dragshome" id= "que-dlines-svg-dragshome" width="'+bgImage.width+'" height="'+50*questionLines.length+'"></svg>';var dragSVG,bits,draghomeSvg=document.getElementById("que-dlines-svg-dragshome"),dropzoneSvg=document.getElementById("que-dlines-svg");for(let line=0;line<questionLines.length;line++){if(startcoordinates="50,"+(height=25+50*line)+";10",endcoordinates="200,"+height+";10",dragSVG="",void 0!==(draginitialcoords=this.visibleDropZones["c"+line])&&""!==draginitialcoords){dragSVG=(bits=draginitialcoords.split(";"))[1];var coords=this.parseCoordinates(bits[0],questionLines[line].type);"placed"===dragSVG&&(startcoordinates=coords[0]+";10",endcoordinates=coords[1]+";10")}this.lines[line]=Lines.make([startcoordinates,endcoordinates],[questionLines[line].labelstart,questionLines[line].labelend],questionLines[line].type),"placed"===dragSVG?this.addToSvg(line,dropzoneSvg):this.addToSvg(line,draghomeSvg)}},DrawlinesQuestion.prototype.drawDropzone=function(){var bgImage=document.querySelector("img.dropbackground"),svg=document.querySelector("svg.dropzones");(document.getElementById("que-dlines-dropzone").style.position="relative",document.getElementById("que-dlines-dropzone").style.top=-1*(bgImage.height+1)+"px",document.getElementById("que-dlines-dropzone").style.height=bgImage.height+"px",document.getElementById("que-dlines-droparea").style.height=bgImage.height+"px",svg)||(document.querySelector("#que-dlines-dropzone").innerHTML='<svg xmlns="http://www.w3.org/2000/svg" id= "que-dlines-svg" class= "dropzones" width="'+bgImage.width+'" height="'+bgImage.height+'" ></svg>');this.drawSVGLines(this.questionLines)},DrawlinesQuestion.prototype.repositionDrags=function(){var root=this.getRoot(),thisQ=this;root.find("div.draghomes .marker").not(".dragplaceholder").each((function(key,item){$(item).addClass("unneeded")})),root.find("input.choices").each((function(key,input){var choiceNo=thisQ.getChoiceNoFromElement(input),imageCoords=thisQ.getImageCoords(input);if(imageCoords.length){var drag=thisQ.getRoot().find(".draghomes span.marker.choice"+choiceNo).not(".dragplaceholder");drag.remove();for(var i=0;i<imageCoords.length;i++){var dragInDrop=drag.clone();const screenCoords=thisQ.convertToWindowXY(imageCoords[i]);dragInDrop.data("pagex",screenCoords.x).data("pagey",screenCoords.y),dragInDrop.data("imageCoords",imageCoords[i]),dragInDrop.data("scaleRatio",1),thisQ.sendDragToDrop(dragInDrop,!1,!0)}thisQ.getDragClone(drag).addClass("active"),thisQ.cloneDragIfNeeded(drag)}})),thisQ.questionAnswer=thisQ.getQuestionAnsweredValues()},DrawlinesQuestion.prototype.getQuestionAnsweredValues=function(){let result={};return this.getRoot().find("input.choices").each(((i,inputNode)=>{result[inputNode.id]=inputNode.value})),result},DrawlinesQuestion.prototype.isQuestionInteracted=function(){const oldAnswer=this.questionAnswer,newAnswer=this.getQuestionAnsweredValues();let isInteracted=!1;return JSON.stringify(newAnswer)!==JSON.stringify(oldAnswer)?(isInteracted=!0,isInteracted):(Object.keys(newAnswer).forEach((key=>{newAnswer[key]!==oldAnswer[key]&&(isInteracted=!0)})),isInteracted)},DrawlinesQuestion.prototype.getImageCoords=function(inputNode){var imageCoords=[],val=$(inputNode).val();if(""!==val)for(var coordsStrings=val.split(" "),i=0;i<coordsStrings.length;i++)imageCoords[i]=Lines.Point.parse(coordsStrings[i]);return imageCoords},DrawlinesQuestion.prototype.convertToWindowXY=function(point){var bgImage=this.bgImage();return point.offset(bgImage.offset().left+1,bgImage.offset().top+1)},DrawlinesQuestion.prototype.convertToBgImgXY=function(point){var bgImage=this.bgImage();return point.offset(-bgImage.offset().left-1,-bgImage.offset().top-1)},DrawlinesQuestion.prototype.coordsInBgImg=function(point){var bgImage=this.bgImage(),bgPosition=bgImage.offset();return point.x>=bgPosition.left&&point.x<bgPosition.left+bgImage.width()&&point.y>=bgPosition.top&&point.y<bgPosition.top+bgImage.height()},DrawlinesQuestion.prototype.getRoot=function(){return $(document.getElementById(this.containerId))},DrawlinesQuestion.prototype.bgImage=function(){return this.getRoot().find("img.dropbackground")},DrawlinesQuestion.prototype.handleDragStart=function(e){var thisQ=this,dragged=$(e.target).closest(".marker");if(dragDrop.prepare(e).start){if(dragged.addClass("beingdragged").css("transform",""),!!dragged.hasClass("unneeded")){var hiddenDrag=thisQ.getDragClone(dragged);hiddenDrag.length&&(hiddenDrag.addClass("active"),dragged.offset(hiddenDrag.offset()))}dragDrop.start(e,dragged,(function(){}),(function(x,y,dragged){thisQ.dragEnd(dragged)}))}},DrawlinesQuestion.prototype.dragEnd=function(dragged){var dragXY,placed=!1,choiceNo=this.getChoiceNoFromElement(dragged),bgRatio=this.bgRatio();if(dragged.data("pagex",dragged.offset().left).data("pagey",dragged.offset().top),dragXY=new Lines.Point(dragged.data("pagex"),dragged.data("pagey")),this.coordsInBgImg(dragXY)){this.sendDragToDrop(dragged,!0),placed=!0,dragged.data("imageCoords")&&dragged.data("imageCoords",null);var bgImgXY=this.convertToBgImgXY(dragXY);bgImgXY=new Lines.Point(bgImgXY.x/bgRatio,bgImgXY.y/bgRatio),dragged.data("originX",bgImgXY.x).data("originY",bgImgXY.y)}placed?this.cloneDragIfNeeded(dragged):(this.sendDragHome(dragged),this.removeDragIfNeeded(dragged)),this.saveCoordsForChoice(choiceNo)},DrawlinesQuestion.prototype.getCoordinates=function(svgEl){return[svgEl.childNodes[1].getAttribute("cx")+","+svgEl.childNodes[1].getAttribute("cy")+";"+svgEl.childNodes[1].getAttribute("r"),svgEl.childNodes[2].getAttribute("cx")+","+svgEl.childNodes[2].getAttribute("cy")+";"+svgEl.childNodes[2].getAttribute("r")]},DrawlinesQuestion.prototype.bgRatio=function(){var bgImg=this.bgImage(),bgImgNaturalWidth=bgImg.get(0).naturalWidth;return bgImg.width()/bgImgNaturalWidth},DrawlinesQuestion.prototype.addToSvg=function(lineNumber,svg){this.lineSVGs[lineNumber]=this.lines[lineNumber].makeSvg(svg),this.lineSVGs[lineNumber]&&(this.lineSVGs[lineNumber].setAttribute("data-dropzone-no",lineNumber),"dropzones"===svg.getAttribute("class")?this.lineSVGs[lineNumber].setAttribute("class","dropzone choice"+lineNumber+" placed"):this.lineSVGs[lineNumber].setAttribute("class","dropzone choice"+lineNumber+" inactive"))},DrawlinesQuestion.prototype.updateSvgEl=function(dropzoneNo){this.lines[dropzoneNo].updateSvg(this.lineSVGs[dropzoneNo])},DrawlinesQuestion.prototype.handleMove=function(e,handleIndex,dropzoneNo){var info=dragDrop.prepare(e);if(info.start){var movingDropZone=this,lastX=info.x,lastY=info.y,dragProxy=this.makeDragProxy(info.x,info.y),svg=document.querySelector("svg.dropzones"),maxX=svg.width.baseVal.value,maxY=svg.height.baseVal.value;dragDrop.start(e,$(dragProxy),(function(pageX,pageY){movingDropZone.lines[dropzoneNo].move(handleIndex,parseInt(pageX)-parseInt(lastX),parseInt(pageY)-parseInt(lastY),parseInt(maxX),parseInt(maxY)),lastX=pageX,lastY=pageY,movingDropZone.updateSvgEl(dropzoneNo),movingDropZone.saveCoordsForChoice(dropzoneNo)}),(function(){document.body.removeChild(dragProxy)}))}},DrawlinesQuestion.prototype.handleDragMove=function(e,dropzoneNo){var info=dragDrop.prepare(e);if(!info.start)return;var isMoveFromDragsToDropzones,isMoveFromDropzonesToDrags,movingDrag=this,lastX=info.x,lastY=info.y,dragProxy=this.makeDragProxy(info.x,info.y),svgDragsHome=document.querySelector("svg.dragshome"),svgDropZones=document.querySelector("svg.dropzones"),maxX=svgDragsHome.width.baseVal.value,maxY=svgDragsHome.height.baseVal.value,whichSVG="",bgImage=document.querySelector("img.dropbackground"),svgClass="",selectedElement=this.lineSVGs[dropzoneNo];const dropX=e.clientX,dropY=e.clientY;dragDrop.start(e,$(dragProxy),(function(pageX,pageY){var closeTo=selectedElement.closest("svg");svgClass=closeTo.getAttribute("class"),isMoveFromDragsToDropzones="dragshome"===svgClass&&10===movingDrag.lines[dropzoneNo].centre1.y,isMoveFromDropzonesToDrags="dropzones"===svgClass&&movingDrag.lines[dropzoneNo].centre1.y>bgImage.height-20,(isMoveFromDragsToDropzones||isMoveFromDropzonesToDrags)&&movingDrag.lines[dropzoneNo].addToDropZone(svgDragsHome,svgDropZones,selectedElement,dropX,dropY),"dragshome"===(closeTo=selectedElement.closest("svg")).getAttribute("class")?(maxX=svgDragsHome.width.baseVal.value,maxY=svgDragsHome.height.baseVal.value,whichSVG="DragsSVG"):(maxX=svgDropZones.width.baseVal.value,maxY=svgDropZones.height.baseVal.value,whichSVG="DropZonesSVG"),movingDrag.lines[dropzoneNo].moveDrags(parseInt(pageX)-parseInt(lastX),parseInt(pageY)-parseInt(lastY),parseInt(maxX),parseInt(maxY),whichSVG),lastX=pageX,lastY=pageY,movingDrag.updateSvgEl(dropzoneNo),movingDrag.saveCoordsForChoice(dropzoneNo)}),(function(){document.body.removeChild(dragProxy)}))},DrawlinesQuestion.prototype.makeDragProxy=function(x,y){var dragProxy=document.createElement("div");return dragProxy.style.position="absolute",dragProxy.style.top=y+"px",dragProxy.style.left=x+"px",dragProxy.style.width="1px",dragProxy.style.height="1px",document.body.appendChild(dragProxy),dragProxy},DrawlinesQuestion.prototype.saveCoordsForChoice=function(choiceNo){let imageCoords=[];var items=this.getRoot().find("svg g.choice"+choiceNo),gEleClassAttributes="";items.length&&items.each((function(){var drag=$(this);imageCoords=drag.children("polyline").attr("points"),gEleClassAttributes=drag.attr("class")})),""!==gEleClassAttributes&&gEleClassAttributes.includes("placed")?this.getRoot().find("input.choice"+choiceNo).val(imageCoords+";placed"):""!==gEleClassAttributes&&gEleClassAttributes.includes("inactive")&&this.getRoot().find("input.choice"+choiceNo).val(imageCoords+";inactive"),this.isQuestionInteracted()&&(questionManager.handleFormDirty(),this.questionAnswer=this.getQuestionAnsweredValues())},DrawlinesQuestion.prototype.handleKeyPress=function(e){var drag=$(e.target).closest(".marker"),point=new Lines.Point(drag.offset().left,drag.offset().top),choiceNo=this.getChoiceNoFromElement(drag);switch(e.keyCode){case keys.arrowLeft:case 65:point.x-=1;break;case keys.arrowRight:case 68:point.x+=1;break;case keys.arrowDown:case 83:point.y+=1;break;case keys.arrowUp:case 87:point.y-=1;break;case keys.space:case keys.escape:point=null;break;default:return}if(e.preventDefault(),null!==point){point=this.constrainToBgImg(point),drag.offset({left:point.x,top:point.y}),drag.data("pagex",drag.offset().left).data("pagey",drag.offset().top);var dragXY=this.convertToBgImgXY(new Lines.Point(drag.data("pagex"),drag.data("pagey")));if(drag.data("originX",dragXY.x/this.bgRatio()).data("originY",dragXY.y/this.bgRatio()),this.coordsInBgImg(new Lines.Point(drag.offset().left,drag.offset().top))&&drag.hasClass("unneeded")){this.sendDragToDrop(drag,!0);var hiddenDrag=this.getDragClone(drag);hiddenDrag.length&&hiddenDrag.addClass("active"),this.cloneDragIfNeeded(drag)}}else drag.css("left","").css("top",""),drag.data("pagex",drag.offset().left).data("pagey",drag.offset().top),this.sendDragHome(drag),this.removeDragIfNeeded(drag);drag.focus(),this.saveCoordsForChoice(choiceNo)},DrawlinesQuestion.prototype.constrainToBgImg=function(windowxy){var bgImg=this.bgImage(),bgImgXY=this.convertToBgImgXY(windowxy);return bgImgXY.x=Math.max(0,bgImgXY.x),bgImgXY.y=Math.max(0,bgImgXY.y),bgImgXY.x=Math.min(bgImg.width(),bgImgXY.x),bgImgXY.y=Math.min(bgImg.height(),bgImgXY.y),this.convertToWindowXY(bgImgXY)},DrawlinesQuestion.prototype.getChoiceNoFromElement=function(node){return Number(this.getClassnameNumericSuffix(node,"choice"))},DrawlinesQuestion.prototype.getClassnameNumericSuffix=function(node,prefix){var classes=$(node).attr("class");if(void 0!==classes&&""!==classes)for(var classesarr=classes.split(" "),index=0;index<classesarr.length;index++){if(new RegExp("^"+prefix+"([0-9])+$").test(classesarr[index])){var match=new RegExp("([0-9])+$").exec(classesarr[index]);return Number(match[0])}}return null},DrawlinesQuestion.prototype.handleResize=function(){var thisQ=this,bgRatio=this.bgRatio();this.isPrinting&&(bgRatio=1),this.getRoot().find("div.droparea .marker").not(".beingdragged").each((function(key,drag){$(drag).css("left",parseFloat($(drag).data("originX"))*parseFloat(bgRatio)).css("top",parseFloat($(drag).data("originY"))*parseFloat(bgRatio)),thisQ.handleElementScale(drag,"left top")})),this.getRoot().find("div.droparea svg.dropzones").width(this.bgImage().width()).height(this.bgImage().height());for(var dropZoneNo=0;dropZoneNo<this.visibleDropZones.length;dropZoneNo++){var originCoords=thisQ.visibleDropZones[dropZoneNo].coords,line=thisQ.lines[dropZoneNo],lineSVG=thisQ.lineSVGs[dropZoneNo];line.parse(originCoords,bgRatio),line.updateSvg(lineSVG);var handles=line.getHandlePositions(),markerSpan=this.getRoot().find("div.ddarea div.markertexts span.markertext"+dropZoneNo);markerSpan.css("left",handles.moveHandles.x-markerSpan.outerWidth()/2-4).css("top",handles.moveHandles.y-markerSpan.outerHeight()/2),thisQ.handleElementScale(markerSpan,"center")}},DrawlinesQuestion.prototype.cloneDrags=function(){var thisQ=this;this.getRoot().find("div.draghomes span.marker").each((function(index,draghome){var drag=$(draghome),placeHolder=drag.clone();placeHolder.removeClass(),placeHolder.addClass("marker"),placeHolder.addClass("choice"+thisQ.getChoiceNoFromElement(drag)),placeHolder.addClass(thisQ.getDragNoClass(drag,!1)),placeHolder.addClass("dragplaceholder"),drag.before(placeHolder)}))},DrawlinesQuestion.prototype.getDragNo=function(drag){return this.getClassnameNumericSuffix(drag,"dragno")},DrawlinesQuestion.prototype.getDragNoClass=function(drag,includeSelector){var className="dragno"+this.getDragNo(drag);return this.isInfiniteDrag(drag)&&(className="infinite"),includeSelector?"."+className:className},DrawlinesQuestion.prototype.getDragClone=function(drag){return this.getRoot().find(".draghomes span.marker.choice"+this.getChoiceNoFromElement(drag)+this.getDragNoClass(drag,!0)+".dragplaceholder")},DrawlinesQuestion.prototype.dropArea=function(){return this.getRoot().find("div.droparea")},DrawlinesQuestion.prototype.sendDragHome=function(drag){drag.removeClass("beingdragged").addClass("unneeded").css("top","").css("left","").css("transform","");var placeHolder=this.getDragClone(drag);placeHolder.after(drag),placeHolder.removeClass("active")},DrawlinesQuestion.prototype.sendDragToDrop=function(drag,isScaling){let initialLoad=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var dropArea=this.dropArea(),bgRatio=this.bgRatio();drag.removeClass("beingdragged").removeClass("unneeded");var dragXY=this.convertToBgImgXY(new Lines.Point(drag.data("pagex"),drag.data("pagey")));isScaling?(drag.data("originX",dragXY.x/bgRatio).data("originY",dragXY.y/bgRatio),drag.css("left",dragXY.x).css("top",dragXY.y)):(drag.data("originX",dragXY.x).data("originY",dragXY.y),drag.css("left",dragXY.x*bgRatio).css("top",dragXY.y*bgRatio)),initialLoad||drag.data("scaleRatio",bgRatio),dropArea.append(drag),this.handleElementScale(drag,"left top")},DrawlinesQuestion.prototype.cloneDragIfNeeded=function(drag){var inputNode=this.getInput(drag),noOfDrags=Number(this.getClassnameNumericSuffix(inputNode,"noofdrags")),displayedDragsInDropArea=this.getRoot().find("div.droparea .marker.choice"+this.getChoiceNoFromElement(drag)+this.getDragNoClass(drag,!0)).length,displayedDragsInDragHomes=this.getRoot().find("div.draghomes .marker.choice"+this.getChoiceNoFromElement(drag)+this.getDragNoClass(drag,!0)).not(".dragplaceholder").length;if((this.isInfiniteDrag(drag)||!this.isInfiniteDrag(drag)&&displayedDragsInDropArea<noOfDrags)&&0===displayedDragsInDragHomes){var dragClone=drag.clone();dragClone.addClass("unneeded").css("top","").css("left","").css("transform",""),this.getDragClone(drag).removeClass("active").after(dragClone),questionManager.addEventHandlersToMarker(dragClone)}},DrawlinesQuestion.prototype.removeDragIfNeeded=function(drag){for(var dragsInHome=this.getRoot().find("div.draghomes .marker.choice"+this.getChoiceNoFromElement(drag)+this.getDragNoClass(drag,!0)).not(".dragplaceholder"),displayedDrags=dragsInHome.length;displayedDrags>1;)dragsInHome.first().remove(),displayedDrags--},DrawlinesQuestion.prototype.getInput=function(drag){var choiceNo=this.getChoiceNoFromElement(drag);return this.getRoot().find("input.choices.choice"+choiceNo)},DrawlinesQuestion.prototype.handleElementScale=function(element,type){var bgRatio=parseFloat(this.bgRatio());this.isPrinting&&(bgRatio=1),$(element).css({"-webkit-transform":"scale("+bgRatio+")","-moz-transform":"scale("+bgRatio+")","-ms-transform":"scale("+bgRatio+")","-o-transform":"scale("+bgRatio+")",transform:"scale("+bgRatio+")","transform-origin":type})},DrawlinesQuestion.prototype.isInfiniteDrag=function(drag){return drag.hasClass("infinite")},DrawlinesQuestion.prototype.waitForAllImagesToBeLoaded=function(){this.allImagesLoaded||(null!==this.imageLoadingTimeoutId&&clearTimeout(this.imageLoadingTimeoutId),this.getNotYetLoadedImages().length>0?this.imageLoadingTimeoutId=setTimeout((function(){this.waitForAllImagesToBeLoaded()}),100):(this.allImagesLoaded=!0,this.cloneDrags(),this.drawDropzone()))},DrawlinesQuestion.prototype.getNotYetLoadedImages=function(){return this.getRoot().find(".drawlines img.dropbackground").not((function(i,imgNode){return this.imageIsLoaded(imgNode)}))},DrawlinesQuestion.prototype.imageIsLoaded=function(imgElement){return imgElement.complete&&0!==imgElement.naturalHeight};var questionManager={eventHandlersInitialised:!1,markerEventHandlersInitialised:{},isPrinting:!1,isKeyboardNavigation:!1,questions:{},noOfLines:null,dropZones:[],questionLines:[],init:function(containerId,readOnly,visibleDropZones,questionLines){if(questionManager.questions[containerId]=new DrawlinesQuestion(containerId,readOnly,visibleDropZones,questionLines),questionManager.questions[containerId].updateCoordinates(),!questionManager.markerEventHandlersInitialised.hasOwnProperty(containerId)){questionManager.markerEventHandlersInitialised[containerId]=!0;var questionContainer=document.getElementById(containerId);if(questionContainer.classList.contains("drawlines")&&!questionContainer.classList.contains("qtype_drawlines-readonly")){var dropArea=document.querySelector(".droparea");dropArea.addEventListener("mousedown",questionManager.handleEventMove),dropArea.addEventListener("touchstart",questionManager.handleEventMove);var drags=document.querySelector(".draghomes");drags.addEventListener("mousedown",questionManager.handleEventDragMove),drags.addEventListener("touchstart",questionManager.handleEventDragMove)}}},handleEventMove:function(event){var dropzoneNo,handleIndex,question=questionManager.getQuestionForEvent(event);event.target.closest(".dropzone .startcircle.shape")?(dropzoneNo=event.target.closest("g").dataset.dropzoneNo,handleIndex="0",question.handleMove(event,handleIndex,dropzoneNo)):event.target.closest(".dropzone .endcircle.shape")?(dropzoneNo=event.target.closest("g").dataset.dropzoneNo,handleIndex="1",question.handleMove(event,handleIndex,dropzoneNo)):event.target.closest("polyline.shape")&&(dropzoneNo=event.target.closest("g").dataset.dropzoneNo,question.handleDragMove(event,dropzoneNo))},handleEventDragMove:function(event){var dropzoneNo,question=questionManager.getQuestionForEvent(event);event.target.closest(".dropzone polyline.shape")&&(dropzoneNo=event.target.closest("g").dataset.dropzoneNo,question.handleDragMove(event,dropzoneNo),question.saveCoordsForChoice(dropzoneNo))},getSvg:function(){var svg=document.querySelector(".droparea svg");return null===svg?null:svg},getFormValue:function(name,indexes){return this.getEl(name,indexes).value},addEventHandlersToMarker:function(element){element.on("mousedown touchstart",questionManager.handleDragStart).on("keydown keypress",questionManager.handleKeyPress).focusin((function(e){questionManager.handleKeyboardFocus(e,!0)})).focusout((function(e){questionManager.handleKeyboardFocus(e,!1)}))},handleDragStart:function(e){e.preventDefault();var question=questionManager.getQuestionForEvent(e);question&&question.handleDragStart(e)},handleKeyPress:function(e){var question=questionManager.getQuestionForEvent(e);question&&question.handleKeyPress(e)},handleWindowResize:function(isPrinting){for(var containerId in questionManager.questions)questionManager.questions.hasOwnProperty(containerId)&&(questionManager.questions[containerId].isPrinting=isPrinting,questionManager.questions[containerId].handleResize())},handleKeyboardFocus:function(e,isNavigating){questionManager.isKeyboardNavigation=isNavigating},fixLayoutIfThingsMoved:function(){questionManager.isKeyboardNavigation||this.handleWindowResize(questionManager.isPrinting),setTimeout((function(){questionManager.fixLayoutIfThingsMoved(questionManager.isPrinting)}),100)},getQuestionForEvent:function(e){var containerId=$(e.currentTarget).closest(".que.drawlines").attr("id");return questionManager.questions[containerId]},handleFormDirty:function(){const responseForm=document.getElementById("responseform");FormChangeChecker.markFormAsDirty(responseForm)}};return{init:questionManager.init}}));

//# sourceMappingURL=question.min.js.map